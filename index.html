<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" type="text/css" href="./css/style.css">
    <script src="script.js"></script>
    <!-- Google Fonts Link For Icons -->
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@48,400,0,0" />

    <link rel="icon" href="img/icons/EternalSunshine.png" type="image/png">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-auth-compat.js"></script>

    <title>Eternal Sunshine</title>
</head>
<body>

    <header>

        <div class="nome-loja">
            <a href="index.html">
                <h1>Eternal Sunshine</h1>
            </a>
        </div>

        <div class="header-search">
            <form class="search" method="get" action="./view/catalog.html">
                <div class="search-group">
                    <input id="input-search" type="search" autocomplete="off" class="search-input search-suggestion-input" placeholder="O que você procura?">
                    <button class="search-button" type="submit" onclick="">
                        <img id="imgBusca" src="img/icons/procurar.png">
                    </button>
                </div>
            </form>
        </div>

        <div class="header-nav-class">
            <nav>
                <a href="./view/lista_carrinho.html"><img src="img/icons/ic_sacola.png"></a>
                <a><img src="img/icons/ic_account.png?" id="openModalBtn"><p id="name-user"></p></a>
            </nav>
        </div>
    </header>


    <!-- Modal -->
    <div class="modal" id="myModal">
        <div class="modal-content">
            <ul>
                <li><a href="#">Configurações</a></li>
                <li><a href="#">Perfil</a></li>
                <li><a href="#" id="btnSignOut" onclick="signOut()"></a></li>
            </ul>
        </div>
    </div>
    <script>// Exibe o modal
        const openModalBtn = document.getElementById('openModalBtn');
        const modal = document.getElementById('myModal');
        openModalBtn.addEventListener('click', function() {
            modal.style.display = 'block'; 
        });// Oculta o modal
        window.addEventListener('click', function(event) {
            if (event.target === modal) {
                modal.style.display = 'none'; 
            }
        });
    </script>



    <main>
        <div class="content">
            <main>
                <div class="container">
                    <div class="slider-wrapper">
                        <button id="prev-slide" class="slide-button material-symbols-rounded">
                            chevron_left
                        </button>

                        <ul class="image-list">
                            <img class="image-item" src="img/banners/banner1.png" alt="img-1" />
                            <img class="image-item" src="img/banners/banner2.jpg" alt="img-2" />
                            <img class="image-item" src="img/banners/banner3.png" alt="img-3" />

                        </ul>

                        <button id="next-slide" class="slide-button material-symbols-rounded">
                            chevron_right
                        </button>
                    </div>

                    <div class="slider-scrollbar">
                        <div class="scrollbar-track">
                            <div class="scrollbar-thumb"></div>
                        </div>
                    </div>
                </div>

                <div class="div_titles">
                    <h1 align="center" class="titles">Seções</h1>
                </div>

                <div class="secao">
                    <section id="p1">
                        <a href="./view/catalog.html?categoria=feminina">
                            <h2>Feminina</h2>
                            <p>A última moda em roupas femininas. De vestidos a blusas e calças elegantes, nossa coleção
                                foi cuidadosamente selecionada para mulheres que valorizam o estilo e o conforto.</p>
                            <div class="languages">
                                <a href="./view/catalog.html?categoria=feminina">
                                    <div class="langprimary"></div>
                                    <p>Adulto</p>
                                </a>
                                <a href="./view/catalog.html?categoria=feminina-infantil">
                                    <div class="langprimary"></div>
                                    <p>Infantil</p>
                                </a>
                            </div>
                        </a>
                    </section>

                    <section id="p2">
                        <a href="./view/catalog.html?categoria=masculina">
                            <h2>Masculina</h2>
                            <p>As últimas tendências em roupas masculinas. De camisas casuais a trajes formais, nossa
                                coleção oferece opções versáteis para homens que desejam se vestir com estilo.</p>
                            <div class="languages">
                                <a href="./view/catalog.html?categoria=masculina-infantil">
                                    <div class="langprimary"></div>
                                    <p>Adulto</p>
                                </a>
                                <a href="./view/catalog.html?categoria=masculina-infantil">
                                    <div class="langprimary"></div>
                                    <p>Infantil</p>
                                </a>
                            </div>
                        </a>
                    </section>

                    <section id="p3">
                        <h2>Plus Size</h2>
                        <p>Encontre o estilo perfeito em nossa coleção Plus Size, projetada para realçar a beleza e a
                            confiança de todas as formas e tamanhos.</p>
                        <div class="languages">
                            <div class="langprimary"></div>
                            <p>Adulto</p>
                            <div class="langprimary"></div>
                            <p>Infantil</p>
                    </section>

                    <section id="p4">
                        <h2>Esportiva</h2>
                        <p>Alcance seu melhor desempenho com nossa linha de roupas esportivas. Desenvolvidas com tecidos
                            de alta qualidade e designs ergonômicos.</p>
                        <div class="languages">
                            <div class="langprimary"></div>
                            <p>Adulto</p>
                            <div class="langprimary"></div>
                            <p>Infantil</p>
                    </section>
                </div>

                <div class="container-image">
                    <div class="imagem">
                        <img src="./img/banners/moda.jpg" alt="Descrição da sua imagem">
                    </div>
                    <div class="texto">
                        <h2>Conheça nossa loja</h2>
                        <p>Vista-se com as últimas tendências da moda e encontre o look perfeito para você. Aqui você
                            encontra peças de qualidade para todas as ocasiões, desde um dia casual até um evento
                            especial.</p>
                        <a href="#">Saiba Mais</a>
                    </div>
                </div>

            <script>

                // Configurações do Firebase
                const firebaseConfig = {
                    apiKey: "AIzaSyDKROCfYUdEzG8gCkjVYGfHwDHsGhvu7ZA",
                    authDomain: "clothingsales-2ace7.firebaseapp.com",
                    projectId: "clothingsales-2ace7",
                    storageBucket: "clothingsales-2ace7.appspot.com",
                    messagingSenderId: "856958563843",
                    appId: "1:856958563843:web:7758d4e8948316a5e44036"
                };

             

                // Inicialize o Firebase
                firebase.initializeApp(firebaseConfig);
              
                firebase.auth().onAuthStateChanged(function(user) {
                if (user) {
                    // O usuário está autenticado.
                    console.log("Usuário está logado:", user);
                    setUserName();
                    const btnSignOut = document.getElementById('btnSignOut');
                    btnSignOut.textContent = "Sair"
                } else {
                    // O usuário não está autenticado.
                    console.log("Usuário não está logado.");
                   
                }
                });

                // Referência ao Firestore
                const db = firebase.firestore();
                

                async function adicionarAoCarrinho(produtoId) {
                    // Verificar se o usuário está autenticado
                    const user = firebase.auth().currentUser;
                    if (!user) {
                        window.location.href = './view/login.html';
                        return;
                    }

                    try {
                        // Referência ao documento do usuário no Firestore
                        const userDocRef = db.collection('usuarios').doc(user.uid);

                        // Referência à coleção "carrinho" dentro do documento do usuário
                        const carrinhoRef = userDocRef.collection('carrinho');

                        // Adicionar o produto ao carrinho
                        await carrinhoRef.add({
                            produtoId: produtoId, 
                            quantidade: 1, 
                            
                        });

                        alert('Produto adicionado ao carrinho com sucesso!');
                
                        console.error('id do produto:', produtoId);
                    } catch (error) {
                        console.error('Erro ao adicionar produto ao carrinho:', error);
                        alert('Erro ao adicionar produto ao carrinho. Por favor, tente novamente mais tarde.');
                    }
                }

                function setUserName() {
                    // Verifica se o usuário está autenticado
                    const user = firebase.auth().currentUser;

                    if (user) {
                        // Referência ao documento do usuário no Firestore
                        const usuariosRef = db.collection('usuarios').doc(user.uid);
                

                        // Obtém os dados do usuário do Firestore
                        usuariosRef.get().then(doc => {
                            if (doc.exists) {
                                // Define o nome de usuário na interface do usuário
                                const name_user = document.getElementById('name-user');
                                name_user.textContent = doc.data().username;
                                console.log("nome do usuario:", doc.data().username);
                            } else {
                                console.log('Documento do usuário não encontrado.');
                            }
                        }).catch(error => {
                            console.log('Erro ao obter dados do usuário:', error);
                        });
                    }
                }

                // Função para recuperar produtos aleatórios
                async function getProdutosAleatorios(categoria) {
                    const produtosRef = db.collection('Roupas').doc(categoria).collection('Adulto');
                    
                    
                    const snapshot = await produtosRef.limit(3).get(); // Limita a 3 produtos para cada categoria
                    
                    // Converte o snapshot em uma matriz de objetos de produtos
                    const produtos = [];
                    snapshot.forEach(doc => {
                        produtos.push(doc.data());
                    });

                    return produtos;
                }


                // Função para exibir produtos aleatórios na página principal
                async function exibirProdutosAleatorios() {
                  
                    const produtosMasculinos = await getProdutosAleatorios('Masculino');

                    
                    const produtosFemininos = await getProdutosAleatorios('Feminino');
                    const produtosAleatorios = produtosMasculinos.concat(produtosFemininos);
                    produtosAleatorios.sort(() => Math.random() - 0.5);
                    const produtosContainer = document.getElementById('produtos-container');
                    produtosContainer.innerHTML = '';

                  
                    produtosAleatorios.forEach(produto => {
                    console.log('Dados do produto:', produto); // Adiciona esta linha
                    const produtoElement = document.createElement('div');
                    produtoElement.classList.add('produto');

                    // Adiciona informações do produto ao elemento
                    produtoElement.innerHTML = `
                        <img src="${produto.img}" alt="Imagem da roupa">
                        <h3>${produto.nome}</h3>
                        <p>Preço: ${produto.valor}</p>
                        <button class="btn-adicionar" onClick="adicionarAoCarrinho('${produto.id}')">Adicionar ao Carrinho</button>
                        <!-- Adicionem mais informações conforme necessário -->
                    `;

                    // Adiciona o elemento do produto ao container de produtos
                    produtosContainer.appendChild(produtoElement);
                });

                }
                exibirProdutosAleatorios();

                function signOut() {
                    firebase.auth().signOut()
                        .then(() => {
                            console.log('Usuário deslogado com sucesso');
                            window.location.href = 'index.html';
                        })
                        .catch((error) => {
                            console.error('Erro ao deslogar:', error);
                        });
                }

             </script>
           
         </main> 
         </div>
            
    </main>
    <br><br>

                <script src="./script/firebase.js"></script>
            </main>
        </div>
        
    <div class="barra-icones">
        <div class="row-icones">
            <a href=""><img src="./img/icons/ic_apple.png" /></a>
            <a href=""><img src="./img/icons/facebook_black.png" /></a>
            <a href=""><img src="./img/icons/instagram_black.png" /></a>
            <a href=""><img src="./img/icons/ic_apple.png" /></a>
        </div>
    </div>

    <footer>
        <div class="footer-middle">

            <div class="item-list">
                <h4>Central de Ajuda</h4>
                <ul>
                    <li>Seg. a Sex. das 7:30 às 17:20</li>
                    <li>(47) 3309-0200</li>
                    <li>(47) 99245-6929</li>
                    <li>eternal-sunshine@gmail.com</li>
                </ul>
            </div><br>

            <div class="item-list">
                <h4>Informações</h4>
                <ul>
                    <li>Meus Pedidos</li>
                    <li>Seja um Revendedor</li>
                    <li>Sobre a Eternal-sunshine</li>
                    <li>Programa de Cashback</li>
                </ul>
            </div><br>

            <div class="item-list">
                <h4>Destaques</h4>
                <ul>
                    <li>Seg. a Sex. das 7:30 às 17:20</li>
                    <li>(47) 3309-0200</li>
                    <li>(47) 99245-6929</li>
                    <li>eternal-sunshine@gmail.com</li>
                </ul>
            </div>
        </div>
        <p class="rodape-direitos">Eternal Sunshine todos os direitos reservados © 2024</p>
    </footer>
</body>
</html>